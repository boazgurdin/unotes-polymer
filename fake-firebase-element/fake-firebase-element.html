<link rel="import" href="/components/polymer/polymer.html">
<link rel="import" href="/components/core-ajax/core-ajax.html">
<polymer-element name="fake-firebase-element" attributes="data keys ref location">
  <template>
    <core-ajax auto id="notesCaller" url="notes_sample.json" handleAs="json" on-core-response="{{setNotes}}"></core-ajax>
    <core-ajax auto id="scriptCaller"  url="script_sample.json" handleAs="json" on-core-response="{{setScript}}"></core-ajax>
  </template>
  <script>
  Polymer({

    ready: function() {
      console.log("fake-firebase ready");
      this.ref = { push: function(_) {}  };  //fake firebaseReference.push()
      this.data = {};
      this.keys = {};
    },

    updateData: function() {
      console.log("updating data in fake-firebase-element");
      if(this.location.indexOf("script") > 0) {//if this is a firebase call to get notes
        this.data = this.script;
        this.keys = Object.keys(this.script);
        console.log("set data to script");
      }
      else if(this.location.indexOf("notes") > 0) {//if this is a firebase call to get notes
        this.data = this.notes;
        this.keys = Object.keys(this.notes);
        console.log("set data to notes");
      }
      else {
        console.log("bad location: " + location);
      }
    },

    setNotes: function() {
      this.notes = this.$.notesCaller.response;
      this.updateData();
      console.log("set notes");
    },

    setScript: function() {
      this.script = this.$.scriptCaller.response;
      this.updateData();
      console.log("set script");
    },

    locationChanged: function() {
      console.log("location changed");
      if(!this.location || typeof this.location!="string") {
        console.log("location is undefined or null or not a string");
      }
      else {
        this.updateData();
      }
    }
  });
  </script>
</polymer-element>
